function colorbar_bw(a){mx=255;mn=0;span=Math.round((mx-mn)/a);r=g=b=[];for(i=0;i<a;i+=1)r.push(mn+span*i),g.push(mn+span*i),b.push(mn+span*i);return[r,g,b]}
function colorbar(a,c,e,d){this.cvalues=[];range=0.05*(a-c);a+=range;c+=range;spans=(a-c)/e;for(i=c;i<=a;i+=spans)this.cvalues.push(i);switch(d){case "grey":rgb=colorbar_grey(e);break;case "bw":rgb=colorbar_bw(e);break;case "jet":rgb=colorbar_jet(e)}this.r=rgb[0];this.g=rgb[1];this.b=rgb[2];this.pick_color=function(a){lst=this.r.length-1;var c=gs=bs=0;if(void 0===a)c=gs=bs=255;else if(a<=this.cvalues[0])c=gs=bs=0;else if(a>this.cvalues[lst])c=gs=bs=255;else if(a==this.cvalues[lst])c=gs=bs=0;else for(i in this.cvalues)if(0==
i)c=gs=bs=200;else if(sv=this.cvalues[i-1],hsv=this.cvalues[i],a>=sv&&a<hsv){c=this.r[i];gs=this.g[i];bs=this.b[i];break}return"rgb("+c+","+gs+","+bs+")"}}function colorbar_grey(a){mx=255;mn=70;span=Math.round((mx-mn)/a);r=g=b=[];for(i=0;i<a;i+=1)r.push(mn+span*i),g.push(mn+span*i),b.push(mn+span*i);return[r,g,b]}
function colorbar_hsv(){r=[];g=[];b=[];seg_length=Math.round(levels/5)-1;cps=Math.round(255/seg_length);r=[];g=[];b=[];for(i=0;i<=seg_length;i+=1)r.push(0),g.push(0),b.push(i*cps);for(i=0;i<=seg_length;i+=1)r.push(0),g.push(i*cps),b.push(255);for(i=0;i<=seg_length;i+=1)r.push(i*cps),g.push(255),b.push(255-i*cps);for(i=0;i<=seg_length;i+=1)r.push(255),g.push(255-i*cps),b.push(0);for(i=0;i<=seg_length;i+=1)r.push(255-i*cps),g.push(0),b.push(0);return[r,g,b]}
function colorbar_jet(a){seg_length=Math.round(a/5)-1;cps=Math.round(255/seg_length);r=[];g=[];b=[];for(i=0;i<=seg_length;i+=1)r.push(0),g.push(0),b.push(i*cps);for(i=0;i<=seg_length;i+=1)r.push(0),g.push(i*cps),b.push(255);for(i=0;i<=seg_length;i+=1)r.push(i*cps),g.push(255),b.push(255-i*cps);for(i=0;i<=seg_length;i+=1)r.push(255),g.push(255-i*cps),b.push(0);for(i=0;i<=seg_length;i+=1)r.push(255-i*cps),g.push(0),b.push(0);return[r,g,b]}
function Fig(a){this.ctx=document.getElementById(a).getContext("2d");this.x_label_offset=22;this.y_label_offset=35;this.w=$("#"+a).width();this.h=$("#"+a).height();this.w-=this.y_label_offset;this.h-=this.x_label_offset;this.clearPlot=function(){this.ctx.clearRect(0,0,this.w+this.y_label_offset,this.h+this.x_label_offset)}}function digit(a){return 10>a?"0"+a:a}
Fig.prototype.gridmesh=function(a,c,e,d){this.clearPlot();count=e.length;x_vals=a.length;y_vals=c.length;dy=c[c.length-1]-c[0];y_unitsize=this.h/dy;y_size=[];for(i in c)i*=1,dv=i==c.length-1?c[i]-c[i-1]:c[i+1]-c[i],y_size.push(dv*y_unitsize);dx=a[a.length-1]-a[0];x_unitsize=this.w/dx;x_size=[];for(j in a)j*=1,k=j+1,dv=j==a.length-1?a[j]-a[j-1]:a[k]-a[j],x_size.push(dv*x_unitsize);width=this.w/count;for(i=0;i<=count;i+=(count-1)/4)t=new Date(1E3*a[Math.round(i)]),ts=digit(t.getUTCHours())+":"+digit(t.getUTCMinutes()),
this.ctx.fillStyle="#000000",this.ctx.fillText(ts,0.97*i*width+this.y_label_offset-10,this.h+20),this.ctx.lineWidth=2,this.ctx.lineCap="butt",this.ctx.strokeStyle="#000000",this.ctx.moveTo(Math.round(i*width)+this.y_label_offset,this.h+12),this.ctx.lineTo(Math.round(i*width)+this.y_label_offset,this.h),this.ctx.stroke();numticks=5;dy=(c[c.length-1]-c[0])/numticks;for(i=0;i<c[c.length-1];i+=500)t=parseInt(i),position=this.h-i*y_unitsize,this.ctx.strokeStyle="#000000",this.ctx.fillText(t,3,position);
if(!d||"none"!=d.border)this.ctx.beginPath(),this.ctx.moveTo(this.y_label_offset-1,0),this.ctx.closePath(),this.ctx.lineTo(this.y_label_offset-1,this.h+2),this.ctx.stroke(),this.ctx.beginPath(),this.ctx.moveTo(this.w+this.y_label_offset,this.h+1),this.ctx.closePath(),this.ctx.lineTo(this.y_label_offset-2,this.h+1),this.ctx.stroke();height=this.h/e[0].length;curr_x=this.y_label_offset;for(ob_key in e){val=e[ob_key];A=d&&d.min?d.min:Math.min.apply(Math,val);B=d&&d.max?d.max:Math.max.apply(Math,val);
levels=d&&d.levels?d.levels:50;cmap=d&&d.cmap?d.cmap:"jet";cbr=new colorbar(B,A,levels,cmap);curr_y=this.h;for(ht_key in val)v=val[ht_key],color=cbr.pick_color(v),this.ctx.fillStyle=color,this.ctx.fillRect(curr_x,curr_y-y_size[ht_key],x_size[ob_key],y_size[ht_key]),this.ctx.strokeStyle=color,this.ctx.strokeRect(curr_x,curr_y-y_size[ht_key],x_size[ob_key],y_size[ht_key]),curr_y-=y_size[ht_key];curr_x+=x_size[ob_key]}};function digit(a){return 10>a?"0"+a:a};

